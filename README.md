# bili 评论功能增强

## 使用场景

截图后不需要额外保存即可粘贴到评论框，支持网页右键复制图片粘贴。多张图片仅支持文件夹中选中复制，微信等软件的聊天框中仅存在一张图片时可以复制，多张图片或者带文字不行。

## 想图文一起复制粘贴怎么办

目前不可行，以 windows 为例子，操作系统本身内置了一些类型，叫“标准剪贴板格式”。这些标准格式里确实只支持单一的格式，比如要么文本、要么图片。但是：
图文混排的富文本的话一般会转成 HTML 或者 RTF 之类的结构，就可以当纯文本读写了，然后接收端需要自己解析取得的内容。比如从网页上复制一大段内容、粘贴到 Word 里、会发现它还带着样式，就是这种。
操作系统还提供了 RegisterClipboardFormat 这样的 API，可以自己注册自己的自定义格式。
（参考：https://segmentfault.com/q/1010000044261985 ）

所以只支持一些简单的图片复制，像微信 qq 和 word 的图文复制都是需要客户端解析的。
（其实HTML的图文复制格式clipboardAPI倒是支持，但是图文上传不仅仅是粘贴html这么简单。）

## 原理

clipboard.item有两个属性：
- kind：用于快速区分数据的基本类型（字符串或文件）。这对于初步判断数据的处理方式非常有用。
- type: 属性提供了更详细的 MIME 类型信息，用于确定具体的数据格式,包括html等格式。
为了方便只对kind进行了判断。

b站带评论区的页面目前有：
- video：视频
- list：稍后再看
- bangumi：番剧纪录片等
- cheese： 课程
- dynamic：动态
- read：专栏
暂时只支持前三种页面，专栏类似旧版评论区用的vue3架构，其它用的lit架构。

## 彩蛋（

b站的评论图片上传接口没做限制，然后只在前端进行了上传数量限制判断，也就是一次最多发九张图，所以自然是可以绕过的。我测试了一下一次发了五十多张图，直接刷了200M的流量，不知道上限能发多少...